const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SurveyQuestion-Cn6yZbAB.js","assets/ui-components-E1kookGP.js","assets/vendor-Bo00a0u0.js","assets/index-CxZZOcZu.js","assets/data-management-BXwEc-vo.js","assets/ui-framework-_byMagRW.js","assets/index-ysO5ek1n.css"])))=>i.map(i=>d[i]);
import{m as L,u as be,A as je,_ as ve}from"./index-CxZZOcZu.js";import{j as e,u as we,f as P,v as Ne,w as Y,x as Se,y as ke,z as Ce,O as Ee,D as Ie,E as Le,J as Ae,X as _e,K as ze,N as Pe,Q as Z,V as Re}from"./ui-components-E1kookGP.js";import{L as I,i as $e,j as Me,r as n,d as q}from"./vendor-Bo00a0u0.js";import{u as Oe}from"./forms-Dvzypixn.js";import{u as Qe}from"./directoryStore-HDTwRuRx.js";import{u as Be}from"./surveyStore-VDgMCFEy.js";import{surveyQuestions as p}from"./SurveyQuestion-Cn6yZbAB.js";import"./data-management-BXwEc-vo.js";import"./ui-framework-_byMagRW.js";const Te=({serviceData:s,onBack:l})=>e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 pt-20",children:e.jsxs("div",{className:"container mx-auto px-4 pt-4",children:[e.jsxs("div",{className:"flex items-center py-2 mb-4",children:[e.jsx(I,{to:"/",className:"text-gray-500 hover:text-gray-800 transition-colors",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(P,{className:"mx-2 text-gray-300 h-4 w-4"}),e.jsx(I,{to:"/directory",className:"text-gray-500 hover:text-gray-800 transition-colors text-sm",children:"Direktori"}),e.jsx(P,{className:"mx-2 text-gray-300 h-4 w-4"}),e.jsx(I,{to:`/service/${s==null?void 0:s.id}`,className:"text-gray-500 hover:text-gray-800 transition-colors text-sm",children:(s==null?void 0:s.name)||""}),e.jsx(P,{className:"mx-2 text-gray-300 h-4 w-4"}),e.jsxs("span",{className:"text-gray-800 text-sm font-medium",children:["Survey  ",(s==null?void 0:s.name)||""]})]}),e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("button",{onClick:l,className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Back to service details",children:[e.jsx(Ne,{className:"h-5 w-5 mr-2"}),"Kembali"]})}),e.jsxs("div",{className:"mt-8 mb-8 text-center",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-teal-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-3 bg-clip-text text-transparent bg-gradient-to-r from-teal-500 to-blue-600",children:"SURVEI PERSEPSI KORUPSI"}),e.jsx("p",{className:"text-gray-600 text-lg",children:(s==null?void 0:s.name)||"Layanan"}),e.jsxs("div",{className:"flex items-center justify-center mt-4 text-gray-500 text-sm",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),e.jsx("p",{children:"Jawab semua pertanyaan untuk menyelesaikan survei"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx(Y,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-2 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-blue-700",children:e.jsx("p",{children:"Survei ini bertujuan untuk mengevaluasi kualitas layanan dan persepsi korupsi. Jawaban Anda akan sangat membantu kami meningkatkan kualitas layanan. Semua jawaban dijamin kerahasiaannya."})})]})})]})}),Ke=({progressPercentage:s,answeredCount:l,totalQuestions:i,onToggleQuestionNav:o})=>e.jsxs("div",{className:"fixed bottom-4 right-4 z-50",children:[e.jsx("div",{className:"relative",children:e.jsxs(L.div,{className:`bg-white/80 backdrop-blur-md shadow-lg rounded-full \r
            py-2 px-3.5\r
            flex flex-row items-center gap-2\r
            border border-gray-100 cursor-pointer`,whileHover:{scale:1.02,boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1)"},transition:{type:"spring",stiffness:400,damping:10},onClick:o,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-r from-teal-400 to-blue-500 flex items-center justify-center text-xs font-medium text-white shadow-sm",children:l}),e.jsxs("span",{className:"text-gray-600 text-xs font-medium",children:["/ ",i]})]}),e.jsxs("span",{className:"text-teal-500 font-semibold text-xs",children:[Math.round(s),"%"]}),e.jsx("div",{className:"w-12 h-2 bg-gray-100/70 rounded-full overflow-hidden",children:e.jsx(L.div,{initial:{width:0},animate:{width:`${s}%`},className:"h-full bg-gradient-to-r from-teal-400 to-blue-500 rounded-full",transition:{type:"spring",stiffness:260,damping:20}})}),e.jsx(Se,{className:"h-4 w-4 text-gray-500"})]})}),e.jsx("style",{jsx:"true",children:`
        .highlight-question {
          animation: pulse-border 0.8s ease-in-out;
        }
        
        @keyframes pulse-border {
          0%, 100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.2); }
          50% { box-shadow: 0 0 0 4px rgba(56, 189, 248, 0); }
        }
      `})]}),De=({showQuestionNav:s,questionNavRef:l,corruptionQuestions:i,serviceQualityQuestions:o,integrityQuestions:f,formValues:b,scrollToQuestion:m,onClose:A})=>{if(!s)return null;const j=r=>b&&!!b[r],h=r=>j(r)?"bg-green-50 text-green-700 shadow-sm border-transparent":"bg-red-50 text-red-600 shadow-sm border-transparent",x=r=>r.replace(/[^0-9]/g,"");return e.jsx(ke,{open:s,onOpenChange:A,children:e.jsxs(Ce,{children:[e.jsx(Ee,{className:"fixed inset-0 bg-black/50 backdrop-blur-lg animate-fade-in z-[999]"}),e.jsxs(Ie,{ref:l,className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl w-[85%] max-w-sm max-h-[75vh] overflow-hidden z-[1000] data-[state=open]:animate-scale-in isolate",style:{boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.1)"},children:[e.jsx("div",{className:"absolute inset-0 -z-10 bg-white rounded-2xl"}),e.jsxs("div",{className:"flex flex-col h-full border border-gray-200 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-4 py-3.5 bg-white",children:[e.jsx(Le,{className:"text-base font-semibold text-gray-800",children:"Navigasi Pertanyaan"}),e.jsx(Ae,{asChild:!0,children:e.jsx("button",{className:"rounded-full p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-100/70 focus:outline-none","aria-label":"Close",children:e.jsx(_e,{size:16})})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto custom-scrollbar space-y-5 bg-white",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-500 font-medium tracking-wider px-0.5",children:"Persepsi Korupsi"}),e.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:i.map(r=>e.jsx("button",{onClick:()=>m(r.id),className:`py-1.5 rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 focus:outline-none active:scale-95 ${h(r.id)}`,children:x(r.id)},r.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-500 font-medium tracking-wider px-0.5",children:"Kualitas Layanan"}),e.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:o.map(r=>e.jsx("button",{onClick:()=>m(r.id),className:`py-1.5 rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 focus:outline-none active:scale-95 ${h(r.id)}`,children:x(r.id)},r.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-500 font-medium tracking-wider px-0.5",children:"Integritas Survei"}),e.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:f.map(r=>e.jsx("button",{onClick:()=>m(r.id),className:`py-1.5 rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 focus:outline-none active:scale-95 ${h(r.id)}`,children:x(r.id)},r.id))})]})]}),e.jsxs("div",{className:"border-t border-gray-200 p-3 bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-400 shadow-sm"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Dijawab"})]}),e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-400 shadow-sm"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Belum Dijawab"})]})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Object.keys(b||{}).length,"/",i.length+o.length+f.length," pertanyaan dijawab"]})]})]})]})]})})},Fe=({previousResponse:s,onContinue:l,onBack:i})=>{const o=s!=null&&s.timestamp?new Date(s.timestamp).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"tidak diketahui";return e.jsx("div",{className:"mx-auto max-w-3xl p-4",children:e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6 mb-8",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ze,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-yellow-800 dark:text-yellow-300 mb-2",children:"Anda sudah mengisi survei ini sebelumnya"}),e.jsxs("p",{className:"text-yellow-700 dark:text-yellow-200 mb-3",children:["Anda telah mengisi survei untuk layanan ini pada ",o,". Anda dapat melihat jawaban sebelumnya atau mengisi ulang survei."]}),s&&e.jsx("div",{className:"mb-4",children:e.jsxs(I,{to:`/history/${s.id}`,className:"inline-flex items-center text-sm font-medium text-yellow-700 dark:text-yellow-300 hover:text-yellow-800 dark:hover:text-yellow-200",children:["Lihat jawaban sebelumnya",e.jsx(Pe,{className:"ml-1 h-4 w-4"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-2",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-md border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Kembali"}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors",children:"Lanjutkan Mengisi Ulang"})]})]})]})})})},Ve=({isSubmitting:s,success:l,progressPercentage:i,onSubmit:o,onResetProgress:f})=>e.jsxs("div",{className:"mt-12",children:[i>0&&e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("button",{type:"button",onClick:f,className:"text-sm text-red-500 hover:text-red-700 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4 mr-1",children:e.jsx("path",{fillRule:"evenodd",d:"M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z",clipRule:"evenodd"})}),"Reset Progres"]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(L.button,{type:"submit",disabled:s||l||i<100,onClick:o,className:`py-4 px-10 rounded-xl text-white font-semibold shadow-lg flex items-center justify-center transition-all ${i===100?"bg-gradient-to-r from-teal-500 to-blue-600 hover:from-teal-600 hover:to-blue-700":"bg-gray-400 cursor-not-allowed"}`,whileHover:i===100?{scale:1.03,y:-2}:{},whileTap:i===100?{scale:.98}:{},children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-3"}),"Mengirim Respon..."]}):l?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-5 h-5 mr-3"}),"Berhasil Terkirim"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-5 h-5 mr-3"}),"Kirim Survei"]})})}),i<100&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-amber-600 text-sm",children:"Mohon isi semua pertanyaan sebelum mengirim."})}),i===100&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-green-600 flex items-center justify-center text-sm",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Semua pertanyaan telah dijawab"]})}),i>0&&e.jsxs("div",{className:"mt-2 flex items-center justify-center text-xs text-green-600",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Progres tersimpan otomatis"]})]}),We=q.lazy(()=>ve(()=>import("./SurveyQuestion-Cn6yZbAB.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(s=>({default:s.SurveyQuestionList}))),ss=()=>{const{serviceId:s}=$e(),l=Me(),{register:i,handleSubmit:o,formState:{errors:f},watch:b,setValue:m}=Oe(),[A,j]=n.useState(null),[h,x]=n.useState(!0),[r,_]=n.useState(!1),[R,$]=n.useState(null),[M,ee]=n.useState(!1),[se,te]=n.useState(!1),[ae,re]=n.useState(null),[ne,O]=n.useState(!1),[Q,B]=n.useState(0),[ie,T]=n.useState(0),[le,v]=n.useState(!1),w=n.useRef(null),{isAuthenticated:y,user:oe}=be(),{getServiceById:K}=Qe(),{saveResponse:ce,markServiceAsCompleted:de,isServiceCompleted:D,getResponsesForService:F}=Be(),d=b(),N=p.filter(t=>t.category==="corruption_perception"),S=p.filter(t=>t.category==="service_quality"),k=p.filter(t=>t.category==="survey_integrity");n.useEffect(()=>{!h&&y&&(()=>{try{const a=localStorage.getItem(`survey_progress_${s}`);if(a){const u=JSON.parse(a);Object.entries(u).forEach(([C,E])=>{m(C,E)}),console.log("Loaded saved progress from localStorage")}}catch(a){console.error("Error loading saved progress:",a)}})()},[h,y,s,m]),n.useEffect(()=>{if(d&&Object.keys(d).length>0&&y)try{localStorage.setItem(`survey_progress_${s}`,JSON.stringify(d))}catch(t){console.error("Error saving progress to localStorage:",t)}},[d,s,y]),n.useEffect(()=>{const t=p.length;let a=0;p.forEach(u=>{d&&d[u.id]&&a++}),T(a),B(a/t*100)},[d]);const me=(t,a)=>{m(t,a)};n.useEffect(()=>{function t(a){w.current&&!w.current.contains(a.target)&&v(!1)}return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[w]);const xe=t=>{const a=document.getElementById(`question-${t}`);a&&(window.scrollTo({top:a.offsetTop-120,behavior:"smooth"}),a.classList.add("highlight-question"),setTimeout(()=>{a.classList.remove("highlight-question")},1500),v(!1))};n.useEffect(()=>{if(!y){l("/login",{state:{redirectTo:`/survey/${s}`}});return}if(D(s)){const a=F(s),u=a.length>0?a[a.length-1]:null;te(!0),re(u),O(!0)}},[y,l,s,D,F]),n.useEffect(()=>{x(!0);try{const t=parseInt(s,10),a=K(isNaN(t)?s:t);a?(j(a),x(!1)):(console.warn(`Service with ID ${s} not found, using fallback`),j({id:s,name:"Layanan Kampus",description:"Deskripsi layanan kampus"}),x(!1))}catch(t){console.error("Error loading service:",t),$("Gagal memuat data layanan"),x(!1)}},[s,K]);const V=async t=>{_(!0);try{let a=0,u=0,C=0,E=N.length>0,J=S.length>0,H=k.length>0;N.forEach(g=>{const c=parseInt(t[g.id]);a+=c,c<5&&(E=!1)}),S.forEach(g=>{const c=parseInt(t[g.id]);u+=c,c<5&&(J=!1)}),k.forEach(g=>{const c=parseInt(t[g.id]);C+=c,c<5&&(H=!1)});const z=(g,c)=>{if(c.length===0)return 0;const ye=c.length*5;return Math.round(g/ye*100)},U=z(a,N),G=z(u,S),X=z(C,k),ge=Math.round(U*.4+G*.4+X*.2),pe=E&&J&&H,fe={id:Date.now().toString(),userId:oe.id,serviceId:s,timestamp:new Date().toISOString(),answers:t,scores:{corruptionPerception:U,serviceQuality:G,surveyIntegrity:X,overall:ge},isFiveStarRating:pe};ce(fe),de(s),localStorage.removeItem(`survey_progress_${s}`),ee(!0),setTimeout(()=>{l(`/ending/${s}`)},1500)}catch(a){console.error("Error submitting survey:",a),$("Gagal mengirim survei")}finally{_(!1)}},W=()=>{l(`/service/${s}`)},ue=()=>{p.forEach(t=>{m(t.id,null)}),localStorage.removeItem(`survey_progress_${s}`),B(0),T(0)},he=()=>{O(!1)};return h?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-solid rounded-full border-t-transparent animate-spin"})}):se&&ne?e.jsx(Fe,{previousResponse:ae,onContinue:he,onBack:W}):e.jsxs("div",{className:"min-h-screen w-full bg-white",children:[e.jsx(Te,{serviceData:A,onBack:W}),e.jsx(Ke,{progressPercentage:Q,answeredCount:ie,totalQuestions:p.length,onToggleQuestionNav:()=>v(!0)}),e.jsx(De,{showQuestionNav:le,questionNavRef:w,corruptionQuestions:N,serviceQualityQuestions:S,integrityQuestions:k,formValues:d,scrollToQuestion:xe,onClose:()=>v(!1)}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-6xl",children:e.jsxs("form",{onSubmit:o(V),className:"space-y-10",children:[R&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700",children:R})}),e.jsx(je,{children:M&&e.jsx(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-green-700",children:"Survei berhasil dikirim! Terima kasih atas partisipasi Anda."})})}),e.jsx(q.Suspense,{fallback:e.jsx("div",{className:"animate-pulse p-8 bg-gray-100 rounded-lg my-4 h-64 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Memuat pertanyaan survei..."})}),children:e.jsx(We,{watchedValues:t=>d&&d[t],onSelectOption:me,register:i,errors:f})}),e.jsx(Ve,{isSubmitting:r,success:M,progressPercentage:Q,onSubmit:o(V),onResetProgress:ue})]})})]})};export{ss as default};
