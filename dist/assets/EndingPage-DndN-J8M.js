import{j as i,a3 as we,v as Me,aq as je,g as ke,V as Ce}from"./ui-components-E1kookGP.js";import{i as Ne,j as Se,u as Ie,r as P,L as Ee}from"./vendor-Bo00a0u0.js";import{u as Te}from"./directoryStore-HDTwRuRx.js";import{u as Fe}from"./surveyStore-VDgMCFEy.js";import{m as M}from"./index-CxZZOcZu.js";import"./data-management-BXwEc-vo.js";import"./ui-framework-_byMagRW.js";var te={};(function x(b,y,I,N){var B=!!(b.Worker&&b.Blob&&b.Promise&&b.OffscreenCanvas&&b.OffscreenCanvasRenderingContext2D&&b.HTMLCanvasElement&&b.HTMLCanvasElement.prototype.transferControlToOffscreen&&b.URL&&b.URL.createObjectURL),A=typeof Path2D=="function"&&typeof DOMMatrix=="function",_=function(){if(!b.OffscreenCanvas)return!1;var a=new OffscreenCanvas(1,1),e=a.getContext("2d");e.fillRect(0,0,1,1);var r=a.transferToImageBitmap();try{e.createPattern(r,"no-repeat")}catch{return!1}return!0}();function W(){}function U(a){var e=y.exports.Promise,r=e!==void 0?e:b.Promise;return typeof r=="function"?new r(a):(a(W,W),null)}var L=function(a,e){return{transform:function(r){if(a)return r;if(e.has(r))return e.get(r);var n=new OffscreenCanvas(r.width,r.height),s=n.getContext("2d");return s.drawImage(r,0,0),e.set(r,n),n},clear:function(){e.clear()}}}(_,new Map),D=function(){var a=Math.floor(16.666666666666668),e,r,n={},s=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(o){var l=Math.random();return n[l]=requestAnimationFrame(function t(c){s===c||s+a-1<c?(s=c,delete n[l],o()):n[l]=requestAnimationFrame(t)}),l},r=function(o){n[o]&&cancelAnimationFrame(n[o])}):(e=function(o){return setTimeout(o,a)},r=function(o){return clearTimeout(o)}),{frame:e,cancel:r}}(),E=function(){var a,e,r={};function n(s){function o(l,t){s.postMessage({options:l||{},callback:t})}s.init=function(t){var c=t.transferControlToOffscreen();s.postMessage({canvas:c},[c])},s.fire=function(t,c,h){if(e)return o(t,null),e;var f=Math.random().toString(36).slice(2);return e=U(function(m){function v(p){p.data.callback===f&&(delete r[f],s.removeEventListener("message",v),e=null,L.clear(),h(),m())}s.addEventListener("message",v),o(t,f),r[f]=v.bind(null,{data:{callback:f}})}),e},s.reset=function(){s.postMessage({reset:!0});for(var t in r)r[t](),delete r[t]}}return function(){if(a)return a;if(!I&&B){var s=["var CONFETTI, SIZE = {}, module = {};","("+x.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{a=new Worker(URL.createObjectURL(new Blob([s])))}catch(o){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("🎊 Could not load worker",o),null}n(a)}return a}}(),K={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function V(a,e){return e?e(a):a}function G(a){return a!=null}function u(a,e,r){return V(a&&G(a[e])?a[e]:K[e],r)}function $(a){return a<0?0:Math.floor(a)}function q(a,e){return Math.floor(Math.random()*(e-a))+a}function z(a){return parseInt(a,16)}function J(a){return a.map(Q)}function Q(a){var e=String(a).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:z(e.substring(0,2)),g:z(e.substring(2,4)),b:z(e.substring(4,6))}}function X(a){var e=u(a,"origin",Object);return e.x=u(e,"x",Number),e.y=u(e,"y",Number),e}function Y(a){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight}function ee(a){var e=a.getBoundingClientRect();a.width=e.width,a.height=e.height}function j(a){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=a,e}function g(a,e,r,n,s,o,l,t,c){a.save(),a.translate(e,r),a.rotate(o),a.scale(n,s),a.arc(0,0,1,l,t,c),a.restore()}function ne(a){var e=a.angle*(Math.PI/180),r=a.spread*(Math.PI/180);return{x:a.x,y:a.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:a.startVelocity*.5+Math.random()*a.startVelocity,angle2D:-e+(.5*r-Math.random()*r),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:a.gravity*3,ovalScalar:.6,scalar:a.scalar,flat:a.flat}}function ae(a,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var r=e.tick++/e.totalTicks,n=e.x+e.random*e.tiltCos,s=e.y+e.random*e.tiltSin,o=e.wobbleX+e.random*e.tiltCos,l=e.wobbleY+e.random*e.tiltSin;if(a.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-r)+")",a.beginPath(),A&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))a.fill(de(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(o-n)*.1,Math.abs(l-s)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var t=Math.PI/10*e.wobble,c=Math.abs(o-n)*.1,h=Math.abs(l-s)*.1,f=e.shape.bitmap.width*e.scalar,m=e.shape.bitmap.height*e.scalar,v=new DOMMatrix([Math.cos(t)*c,Math.sin(t)*c,-Math.sin(t)*h,Math.cos(t)*h,e.x,e.y]);v.multiplySelf(new DOMMatrix(e.shape.matrix));var p=a.createPattern(L.transform(e.shape.bitmap),"no-repeat");p.setTransform(v),a.globalAlpha=1-r,a.fillStyle=p,a.fillRect(e.x-f/2,e.y-m/2,f,m),a.globalAlpha=1}else if(e.shape==="circle")a.ellipse?a.ellipse(e.x,e.y,Math.abs(o-n)*e.ovalScalar,Math.abs(l-s)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):g(a,e.x,e.y,Math.abs(o-n)*e.ovalScalar,Math.abs(l-s)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var d=Math.PI/2*3,w=4*e.scalar,k=8*e.scalar,C=e.x,F=e.y,O=5,S=Math.PI/O;O--;)C=e.x+Math.cos(d)*k,F=e.y+Math.sin(d)*k,a.lineTo(C,F),d+=S,C=e.x+Math.cos(d)*w,F=e.y+Math.sin(d)*w,a.lineTo(C,F),d+=S;else a.moveTo(Math.floor(e.x),Math.floor(e.y)),a.lineTo(Math.floor(e.wobbleX),Math.floor(s)),a.lineTo(Math.floor(o),Math.floor(l)),a.lineTo(Math.floor(n),Math.floor(e.wobbleY));return a.closePath(),a.fill(),e.tick<e.totalTicks}function H(a,e,r,n,s){var o=e.slice(),l=a.getContext("2d"),t,c,h=U(function(f){function m(){t=c=null,l.clearRect(0,0,n.width,n.height),L.clear(),s(),f()}function v(){I&&!(n.width===N.width&&n.height===N.height)&&(n.width=a.width=N.width,n.height=a.height=N.height),!n.width&&!n.height&&(r(a),n.width=a.width,n.height=a.height),l.clearRect(0,0,n.width,n.height),o=o.filter(function(p){return ae(l,p)}),o.length?t=D.frame(v):m()}t=D.frame(v),c=m});return{addFettis:function(f){return o=o.concat(f),h},canvas:a,promise:h,reset:function(){t&&D.cancel(t),c&&c()}}}function Z(a,e){var r=!a,n=!!u(e||{},"resize"),s=!1,o=u(e,"disableForReducedMotion",Boolean),l=B&&!!u(e||{},"useWorker"),t=l?E():null,c=r?Y:ee,h=a&&t?!!a.__confetti_initialized:!1,f=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,m;function v(d,w,k){for(var C=u(d,"particleCount",$),F=u(d,"angle",Number),O=u(d,"spread",Number),S=u(d,"startVelocity",Number),me=u(d,"decay",Number),fe=u(d,"gravity",Number),ve=u(d,"drift",Number),ie=u(d,"colors",J),ge=u(d,"ticks",Number),se=u(d,"shapes"),be=u(d,"scalar"),pe=!!u(d,"flat"),oe=X(d),le=C,re=[],xe=a.width*oe.x,ye=a.height*oe.y;le--;)re.push(ne({x:xe,y:ye,angle:F,spread:O,startVelocity:S,color:ie[le%ie.length],shape:se[q(0,se.length)],ticks:ge,decay:me,gravity:fe,drift:ve,scalar:be,flat:pe}));return m?m.addFettis(re):(m=H(a,re,c,w,k),m.promise)}function p(d){var w=o||u(d,"disableForReducedMotion",Boolean),k=u(d,"zIndex",Number);if(w&&f)return U(function(S){S()});r&&m?a=m.canvas:r&&!a&&(a=j(k),document.body.appendChild(a)),n&&!h&&c(a);var C={width:a.width,height:a.height};t&&!h&&t.init(a),h=!0,t&&(a.__confetti_initialized=!0);function F(){if(t){var S={getBoundingClientRect:function(){if(!r)return a.getBoundingClientRect()}};c(S),t.postMessage({resize:{width:S.width,height:S.height}});return}C.width=C.height=null}function O(){m=null,n&&(s=!1,b.removeEventListener("resize",F)),r&&a&&(document.body.contains(a)&&document.body.removeChild(a),a=null,h=!1)}return n&&!s&&(s=!0,b.addEventListener("resize",F,!1)),t?t.fire(d,C,O):v(d,C,O)}return p.reset=function(){t&&t.reset(),m&&m.reset()},p}var T;function R(){return T||(T=Z(null,{useWorker:!0,resize:!0})),T}function de(a,e,r,n,s,o,l){var t=new Path2D(a),c=new Path2D;c.addPath(t,new DOMMatrix(e));var h=new Path2D;return h.addPath(c,new DOMMatrix([Math.cos(l)*s,Math.sin(l)*s,-Math.sin(l)*o,Math.cos(l)*o,r,n])),h}function ue(a){if(!A)throw new Error("path confetti are not supported in this browser");var e,r;typeof a=="string"?e=a:(e=a.path,r=a.matrix);var n=new Path2D(e),s=document.createElement("canvas"),o=s.getContext("2d");if(!r){for(var l=1e3,t=l,c=l,h=0,f=0,m,v,p=0;p<l;p+=2)for(var d=0;d<l;d+=2)o.isPointInPath(n,p,d,"nonzero")&&(t=Math.min(t,p),c=Math.min(c,d),h=Math.max(h,p),f=Math.max(f,d));m=h-t,v=f-c;var w=10,k=Math.min(w/m,w/v);r=[k,0,0,k,-Math.round(m/2+t)*k,-Math.round(v/2+c)*k]}return{type:"path",path:e,matrix:r}}function he(a){var e,r=1,n="#000000",s='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof a=="string"?e=a:(e=a.text,r="scalar"in a?a.scalar:r,s="fontFamily"in a?a.fontFamily:s,n="color"in a?a.color:n);var o=10*r,l=""+o+"px "+s,t=new OffscreenCanvas(o,o),c=t.getContext("2d");c.font=l;var h=c.measureText(e),f=Math.ceil(h.actualBoundingBoxRight+h.actualBoundingBoxLeft),m=Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent),v=2,p=h.actualBoundingBoxLeft+v,d=h.actualBoundingBoxAscent+v;f+=v+v,m+=v+v,t=new OffscreenCanvas(f,m),c=t.getContext("2d"),c.font=l,c.fillStyle=n,c.fillText(e,p,d);var w=1/r;return{type:"bitmap",bitmap:t.transferToImageBitmap(),matrix:[w,0,0,w,-f*w/2,-m*w/2]}}y.exports=function(){return R().apply(this,arguments)},y.exports.reset=function(){R().reset()},y.exports.create=Z,y.exports.shapeFromPath=ue,y.exports.shapeFromText=he})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),te,!1);const ce=te.exports;te.exports.create;const Pe=({selected:x,onClick:b,emoji:y,label:I,color:N})=>{const B=x===y;return i.jsxs(M.button,{whileHover:{y:-5,scale:1.05},whileTap:{scale:.95},onClick:()=>b(y),className:`flex flex-col items-center space-y-2 transition-all ${B?"scale-110":"opacity-70"}`,children:[i.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full ${B?`bg-${N}-100 shadow-lg shadow-${N}-100/50`:"bg-gray-100"}`,children:i.jsx("span",{className:"text-3xl md:text-4xl",children:y})}),i.jsx("span",{className:`text-sm font-medium ${B?`text-${N}-500`:"text-gray-500"}`,children:I})]})},We=()=>{const{serviceId:x}=Ne(),b=Se(),y=Ie(),{getServiceById:I}=Te(),{updateFeedback:N}=Fe();console.log("EndingPage received state:",y.state),console.log("EndingPage serviceId param:",x);const B=y.state||{},{serviceName:A,overallScore:_,responseId:W,completedAt:U}=B,[L,D]=P.useState(A||"Layanan"),[E,K]=P.useState(null),[V,G]=P.useState(""),[u,$]=P.useState(!1),[q,z]=P.useState(!1),[J,Q]=P.useState(!1),X=[{emoji:"😞",label:"Buruk",color:"red"},{emoji:"😐",label:"Biasa",color:"yellow"},{emoji:"🙂",label:"Baik",color:"blue"},{emoji:"😃",label:"Sangat Baik",color:"green"},{emoji:"🤩",label:"Luar Biasa",color:"purple"}];P.useEffect(()=>{if(q){let g=function(T,R){return Math.random()*(R-T)+T};const ae=Date.now()+3e3,H={startVelocity:30,spread:360,ticks:60,zIndex:0},Z=setInterval(function(){const T=ae-Date.now();if(T<=0)return clearInterval(Z);const R=50*(T/3e3);ce({...H,particleCount:R,origin:{x:g(.1,.3),y:Math.random()-.2}}),ce({...H,particleCount:R,origin:{x:g(.7,.9),y:Math.random()-.2}})},250)}},[q]),P.useEffect(()=>{if(!x){console.warn("No serviceId provided to EndingPage");return}if(!A)try{console.log("Fetching service info for ID:",x);const g=I(x)||I(parseInt(x,10))||I(x.toString());g?(console.log("Found service:",g),D(g.name||"Layanan")):console.warn("Service not found for ID:",x)}catch(g){console.error("Error getting service info:",g)}},[x,I,A]);const Y=()=>{if(E){$(!0);try{console.log("Submitting feedback for serviceId:",x),N(x,{emoji:E,comment:V,timestamp:new Date().toISOString(),responseId:W||`fallback-${Date.now()}`,score:_||0}),z(!0),Q(!0),setTimeout(()=>{console.log("Redirecting to history page"),b("/history")},3e3)}catch(g){console.error("Error submitting feedback:",g),alert("Terjadi kesalahan saat mengirim feedback. Silakan coba lagi.")}finally{$(!1)}}},ee={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.2}}},j={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return P.useEffect(()=>{!y.state&&x&&console.warn("No survey data passed to ending page, will use minimal information")},[y.state,x]),i.jsx("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:i.jsxs(M.div,{variants:ee,initial:"hidden",animate:"visible",className:"max-w-2xl w-full space-y-8 rounded-3xl shadow-xl overflow-hidden relative bg-white/90 backdrop-blur-sm",children:[i.jsx("div",{className:"absolute top-0 inset-x-0 h-3 bg-gradient-to-r from-teal-400 via-blue-500 to-indigo-500"}),i.jsx("div",{className:"absolute -right-16 -top-16 w-48 h-48 rounded-full bg-blue-100 opacity-20"}),i.jsx("div",{className:"absolute -left-16 -bottom-16 w-56 h-56 rounded-full bg-teal-100 opacity-20"}),i.jsx("div",{className:"px-10 pt-14 pb-10 relative z-10",children:J?i.jsxs(i.Fragment,{children:[i.jsx(M.div,{variants:j,className:"mx-auto w-24 h-24 bg-gradient-to-br from-green-400 to-teal-500 flex items-center justify-center rounded-full text-white mb-8",children:i.jsx(we,{className:"w-12 h-12"})}),i.jsx(M.h2,{variants:j,className:"text-center text-3xl font-bold text-gray-800 mb-3",children:"Terima Kasih!"}),i.jsx(M.p,{variants:j,className:"text-center text-gray-600 mb-6",children:"Feedback Anda berhasil dikirim dan sangat berarti bagi kami untuk meningkatkan layanan."}),i.jsxs(M.div,{variants:j,className:"text-center",children:[i.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Anda akan dialihkan ke halaman riwayat survey dalam beberapa saat..."}),i.jsxs(Ee,{to:"/history",className:"inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-gradient-to-r from-teal-500 to-blue-500 hover:from-teal-600 hover:to-blue-600 focus:outline-none",children:[i.jsx(Me,{className:"w-4 h-4 mr-2"})," Lihat Riwayat"]})]})]}):i.jsxs(i.Fragment,{children:[i.jsx(M.div,{variants:j,className:"mx-auto w-24 h-24 bg-gradient-to-br from-blue-400 to-indigo-500 flex items-center justify-center rounded-full text-white mb-8",children:i.jsx(je,{className:"w-12 h-12"})}),i.jsx(M.h2,{variants:j,className:"text-center text-3xl font-bold text-gray-800 mb-2",children:"Terima Kasih!"}),i.jsx(M.p,{variants:j,className:"text-center text-gray-600 mb-2",children:"Survei Anda telah berhasil disimpan. Satu langkah lagi!"}),i.jsx(M.p,{variants:j,className:"text-center text-gray-500 text-sm mb-6",children:"Mohon berikan feedback mengenai pengalaman Anda dengan layanan ini sebelum melanjutkan"}),i.jsxs(M.div,{variants:j,className:"mb-8",children:[i.jsxs("p",{className:"text-center font-medium text-gray-700 mb-5",children:["Bagaimana Pengalaman Anda dengan ",L,"?"]}),i.jsx("div",{className:"flex justify-between items-center flex-wrap gap-4 px-4 md:px-8",children:X.map(g=>i.jsx(Pe,{selected:E,onClick:K,emoji:g.emoji,label:g.label,color:g.color},g.emoji))})]}),i.jsxs(M.div,{variants:j,className:"mb-8",children:[i.jsxs("div",{className:"flex items-center text-gray-700 font-medium mb-3",children:[i.jsx(ke,{className:"w-5 h-5 mr-2"}),i.jsx("span",{children:"Tambahkan Komentar (Opsional)"})]}),i.jsx("div",{className:"relative",children:i.jsx("textarea",{value:V,onChange:g=>G(g.target.value),className:"w-full p-4 border border-gray-200 rounded-xl min-h-[120px] focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white/80",placeholder:"Berikan komentar atau saran Anda..."})})]}),i.jsx(M.div,{variants:j,className:"flex justify-center",children:i.jsx(M.button,{onClick:Y,disabled:!E||u,className:`px-8 py-3 rounded-xl flex items-center justify-center font-medium shadow-md transition-all ${E&&!u?"bg-gradient-to-r from-teal-500 to-blue-500 text-white hover:from-teal-600 hover:to-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,whileHover:E&&!u?{scale:1.05}:{},whileTap:E&&!u?{scale:.95}:{},children:u?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Mengirim..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Kirim Feedback"]})})})]})})]})})};export{We as default};
