import{j as e,ar as J,as as Q,at as X,au as P,av as O,v as I,h as F,aw as ee}from"./ui-components-E1kookGP.js";import{r as y,i as te,j as ae,L as se}from"./vendor-Bo00a0u0.js";import{u as re}from"./directoryStore-HDTwRuRx.js";import{a as ne,b as ie,c as L,m as le}from"./index-CxZZOcZu.js";import{e as ce,d as oe,B as C,S as de,a as ue,b as me,c as fe,f as N}from"./button-B4bQh2Go.js";import{t as k,c as he,n as U,g as R,a as xe,e as ge,h as B,i as T}from"./en-US-D9lzRxDE.js";import{i as ve}from"./id-DKsBABLi.js";import"./data-management-BXwEc-vo.js";import"./ui-framework-_byMagRW.js";function A(a,s){const t=+k(a)-+k(s);return t<0?-1:t>0?1:t}function ye(a){return he(a,Date.now())}function be(a){return s=>{const m=(a?Math[a]:Math.trunc)(s);return m===0?0:m}}function je(a,s){return+k(a)-+k(s)}function pe(a,s){const t=k(a,s==null?void 0:s.in);return t.setHours(23,59,59,999),t}function we(a,s){const t=k(a,s==null?void 0:s.in);return+pe(t,s)==+ce(t,s)}function ke(a,s,t){const[m,r,b]=U(t==null?void 0:t.in,a,a,s),f=A(r,b),i=Math.abs(oe(r,b));if(i<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-f*i);let v=A(r,b)===-f;we(m)&&i===1&&A(m,b)===1&&(v=!1);const h=f*(i-+v);return h===0?0:h}function Ne(a,s,t){const m=je(a,s)/1e3;return be(t==null?void 0:t.roundingMethod)(m)}function De(a,s,t){const m=xe(),r=(t==null?void 0:t.locale)??m.locale??ge,b=2520,f=A(a,s);if(isNaN(f))throw new RangeError("Invalid time value");const i=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:f}),[v,h]=U(t==null?void 0:t.in,...f>0?[s,a]:[a,s]),u=Ne(h,v),w=(R(h)-R(v))/1e3,d=Math.round((u-w)/60);let x;if(d<2)return t!=null&&t.includeSeconds?u<5?r.formatDistance("lessThanXSeconds",5,i):u<10?r.formatDistance("lessThanXSeconds",10,i):u<20?r.formatDistance("lessThanXSeconds",20,i):u<40?r.formatDistance("halfAMinute",0,i):u<60?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",1,i):d===0?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",d,i);if(d<45)return r.formatDistance("xMinutes",d,i);if(d<90)return r.formatDistance("aboutXHours",1,i);if(d<B){const j=Math.round(d/60);return r.formatDistance("aboutXHours",j,i)}else{if(d<b)return r.formatDistance("xDays",1,i);if(d<T){const j=Math.round(d/B);return r.formatDistance("xDays",j,i)}else if(d<T*2)return x=Math.round(d/T),r.formatDistance("aboutXMonths",x,i)}if(x=ke(h,v),x<12){const j=Math.round(d/T);return r.formatDistance("xMonths",j,i)}else{const j=x%12,D=Math.trunc(x/12);return j<3?r.formatDistance("aboutXYears",D,i):j<9?r.formatDistance("overXYears",D,i):r.formatDistance("almostXYears",D+1,i)}}function Se(a,s){return De(a,ye(a),s)}const Me=({feedback:a})=>{const{rating:s,content:t,createdAt:m,user:r,helpfulCount:b,serviceTitle:f}=a,i=Se(new Date(m),{addSuffix:!0,locale:ve}),v=h=>h?h.split(" ").map(u=>u[0]).join("").toUpperCase().substring(0,2):"?";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-10 w-10",children:r.avatar?e.jsx("img",{src:r.avatar,alt:r.name}):e.jsx(ie,{className:"bg-primary/10 text-primary",children:v(r.name)})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i})]})]}),e.jsx("div",{className:"flex",children:Array.from({length:5}).map((h,u)=>e.jsx("svg",{className:`h-5 w-5 ${u<s?"text-yellow-400":"text-gray-300 dark:text-gray-600"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 15.28l6.2 3.64-1.64-7.03L20 7.54l-7.19-.61L10 0 7.19 6.93 0 7.54l5.45 4.35-1.64 7.03z",clipRule:"evenodd"})},u))})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4 whitespace-pre-line",children:t}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(C,{variant:"ghost",size:"sm",className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:["Membantu (",b,")"]})]}),f&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:["Ulasan untuk: ",f]})]})]})},Te=Q,_=y.forwardRef(({className:a,...s},t)=>e.jsx(X,{ref:t,className:L("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a),...s}));_.displayName=X.displayName;const p=y.forwardRef(({className:a,...s},t)=>e.jsx(P,{ref:t,className:L("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a),...s}));p.displayName=P.displayName;const Ae=y.forwardRef(({className:a,...s},t)=>e.jsx(O,{ref:t,className:L("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s}));Ae.displayName=O.displayName;const z=[{id:1,serviceId:1,userId:"user1",rating:4,content:"Pelayanan cukup baik, tapi bisa lebih cepat. Petugas ramah dan membantu tetapi prosesnya masih memakan waktu yang cukup lama.",createdAt:"2023-04-15T09:23:45.000Z",helpfulCount:2,serviceTitle:"Layanan Akademik Fakultas",user:{name:"Hafiz",avatar:null}},{id:2,serviceId:1,userId:"user2",rating:5,content:"Sangat puas dengan pelayanan yang diberikan. Proses cepat dan petugas sangat profesional. Semua kebutuhan saya terpenuhi dengan baik.",createdAt:"2023-04-16T14:30:22.000Z",helpfulCount:5,serviceTitle:"Layanan Akademik Fakultas",user:{name:"Muhamad Arianoor",avatar:null}},{id:3,serviceId:2,userId:"user1",rating:3,content:"Prosedur terlalu berbelit-belit dan memakan waktu lama. Beberapa informasi tidak jelas dan saya harus bertanya berulang kali.",createdAt:"2023-04-18T11:15:08.000Z",helpfulCount:1,serviceTitle:"Layanan Perpustakaan",user:{name:"Hafiz",avatar:null}},{id:4,serviceId:1,userId:"user3",rating:2,content:"Kurang puas dengan layanan ini. Informasi yang diberikan sering tidak konsisten dan waktu tunggu sangat lama.",createdAt:"2023-05-20T10:45:12.000Z",helpfulCount:3,serviceTitle:"Layanan Akademik Fakultas",user:{name:"Handy Hartono",avatar:null}},{id:5,serviceId:1,userId:"user_demo",rating:4,content:"Layanan sudah baik secara keseluruhan. Sistem antrian tertata rapi dan petugas cukup responsif.",createdAt:"2023-06-05T08:30:00.000Z",helpfulCount:0,serviceTitle:"Layanan Akademik Fakultas",user:{name:"Demo User",avatar:null}}],Oe=()=>{const{serviceId:a}=te(),s=ae(),{getServiceById:t}=re(),[m,r]=y.useState(null),[b,f]=y.useState(!0),[i,v]=y.useState(null),[h,u]=y.useState([]),[w,d]=y.useState({average:0,total:0,distribution:[]}),[x,j]=y.useState("newest"),[D,E]=y.useState("all"),[H,Z]=y.useState("all");y.useEffect(()=>{(async()=>{f(!0);try{const c=t(parseInt(a,10)||a);if(!c){v("Layanan tidak ditemukan"),f(!1);return}r(c),await K(c.id)}catch(c){console.error("Error fetching service details:",c),v("Gagal memuat data layanan")}finally{f(!1)}})()},[a,t]);const K=async n=>{try{const c=z.filter(l=>l.serviceId.toString()===n.toString());V(c);const o=Y(c);u(o)}catch(c){console.error("Error fetching feedbacks:",c),v("Gagal memuat umpan balik")}},V=n=>{if(!n||n.length===0){d({average:0,total:0,distribution:[{rating:5,count:0,percentage:0},{rating:4,count:0,percentage:0},{rating:3,count:0,percentage:0},{rating:2,count:0,percentage:0},{rating:1,count:0,percentage:0}]});return}const c=n.length,l=n.reduce((S,M)=>S+M.rating,0)/c,g=[5,4,3,2,1].map(S=>{const M=n.filter(q=>Math.round(q.rating)===S).length,W=M/c*100;return{rating:S,count:M,percentage:W}});d({average:l,total:c,distribution:g})},Y=n=>[...n].sort((c,o)=>new Date(o.createdAt)-new Date(c.createdAt)),$=n=>{j(n);let c=[...h];n==="newest"?c.sort((o,l)=>new Date(l.createdAt)-new Date(o.createdAt)):n==="oldest"?c.sort((o,l)=>new Date(o.createdAt)-new Date(l.createdAt)):n==="highest"?c.sort((o,l)=>l.rating-o.rating):n==="lowest"?c.sort((o,l)=>o.rating-l.rating):n==="helpful"&&c.sort((o,l)=>l.helpfulCount-o.helpfulCount),u(c)},G=n=>{E(n),Z(n);const c=z.filter(l=>l.serviceId.toString()===a.toString());let o=c;if(n!=="all"){const l=parseInt(n,10);o=c.filter(g=>Math.round(g.rating)===l)}x==="newest"?o.sort((l,g)=>new Date(g.createdAt)-new Date(l.createdAt)):x==="oldest"?o.sort((l,g)=>new Date(l.createdAt)-new Date(g.createdAt)):x==="highest"?o.sort((l,g)=>g.rating-l.rating):x==="lowest"?o.sort((l,g)=>l.rating-g.rating):x==="helpful"&&o.sort((l,g)=>g.helpfulCount-l.helpfulCount),u(o)};return b?e.jsx("div",{className:"flex justify-center items-center min-h-[60vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):i?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center p-4",children:[e.jsxs("div",{className:"text-red-500 text-xl mb-4",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),i]}),e.jsxs(C,{onClick:()=>s(-1),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Kembali"]})]}):m?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(se,{to:`/service/${a}`,className:"inline-flex items-center text-secondary-600 hover:text-primary-600",children:[e.jsx(I,{size:16,className:"mr-2"}),"Kembali ke Detail Layanan"]})}),e.jsxs(le.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-sm overflow-hidden mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 px-6 py-8 text-white",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:m.name}),e.jsx("p",{className:"text-white/80",children:"Umpan Balik Pengguna"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center p-6 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"text-4xl font-bold text-secondary-900 mb-1",children:w.average.toFixed(1)}),e.jsx("div",{className:"flex mb-2",children:[1,2,3,4,5].map(n=>e.jsx(F,{size:16,className:`${n<=Math.round(w.average)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},n))}),e.jsxs("div",{className:"text-sm text-gray-500",children:[w.total," ulasan"]})]}),e.jsx("div",{className:"md:col-span-2 space-y-2",children:w.distribution.map(n=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center w-16",children:[e.jsx("span",{className:"text-sm font-medium mr-1",children:n.rating}),e.jsx(F,{size:14,className:"text-yellow-400 fill-yellow-400"})]}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400 rounded-full",style:{width:`${n.percentage}%`}})}),e.jsx("div",{className:"w-12 text-right text-sm text-gray-500",children:n.count})]},n.rating))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Te,{value:H,onValueChange:G,children:e.jsxs(_,{className:"grid grid-cols-6 w-full sm:w-auto",children:[e.jsx(p,{value:"all",children:"Semua"}),e.jsx(p,{value:"5",children:"5"}),e.jsx(p,{value:"4",children:"4"}),e.jsx(p,{value:"3",children:"3"}),e.jsx(p,{value:"2",children:"2"}),e.jsx(p,{value:"1",children:"1"})]})})}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs(de,{value:x,onValueChange:$,children:[e.jsx(ue,{className:"w-full sm:w-[200px]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),e.jsx(me,{placeholder:"Urutkan berdasarkan"})]})}),e.jsxs(fe,{children:[e.jsx(N,{value:"newest",children:"Terbaru"}),e.jsx(N,{value:"oldest",children:"Terlama"}),e.jsx(N,{value:"highest",children:"Rating tertinggi"}),e.jsx(N,{value:"lowest",children:"Rating terendah"}),e.jsx(N,{value:"helpful",children:"Paling membantu"})]})]})})]}),h.length===0?e.jsxs("div",{className:"py-10 text-center",children:[e.jsx("div",{className:"mb-4 text-gray-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Belum ada umpan balik"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Belum ada umpan balik untuk kategori ini."})]}):e.jsx("div",{className:"space-y-6",children:h.map(n=>e.jsx(Me,{feedback:n},n.id))})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center p-4",children:[e.jsx("div",{className:"text-gray-500 text-xl mb-4",children:"Layanan tidak ditemukan"}),e.jsxs(C,{onClick:()=>s("/directory"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Kembali ke Direktori"]})]})};export{Oe as default};
