import{j as e}from"./ui-components-E1kookGP.js";import{j as N,r as p,L as b}from"./vendor-Bo00a0u0.js";import{u as S}from"./index-CxZZOcZu.js";import{u as w}from"./surveyStore-VDgMCFEy.js";import{u as A}from"./directoryStore-HDTwRuRx.js";import{p as I}from"./parseISO-B6o4a0-U.js";import{f as D}from"./format-BWB-Nt1Y.js";import{i as L}from"./id-DKsBABLi.js";import"./data-management-BXwEc-vo.js";import"./ui-framework-_byMagRW.js";import"./en-US-D9lzRxDE.js";const C=()=>{const f=N(),{user:s,isAuthenticated:u}=S(),{allResponses:o,completedServices:n}=w(),{getServiceById:d}=A(),[y,v]=p.useState([]),[g,m]=p.useState(!0);p.useEffect(()=>{if(!u){m(!1);return}(()=>{m(!0);try{console.log("Processing surveys with data:",{allResponses:o,completedServices:n,userId:s==null?void 0:s.id});const c=s!=null&&s.id?o.filter(t=>t.userId===s.id):o;console.log("Filtered user responses:",c);const x=c.map(t=>{var l;const i=d(t.serviceId),a=i?i.name:t.serviceName||`Survei Layanan ${t.serviceId}`;return{id:t.id,serviceId:t.serviceId,title:a,completedAt:t.completedAt?I(t.completedAt):new Date,status:"completed",score:((l=t.scores)==null?void 0:l.overall)||0}});n.forEach(t=>{if(!x.some(a=>a.serviceId===t)){const a=d(t),l=a?a.name:`Survei Layanan ${t}`;x.push({id:`service-${t}`,serviceId:t,title:l,completedAt:new Date,status:"completed",score:0})}});const h=x.sort((t,i)=>i.completedAt.getTime()-t.completedAt.getTime());console.log("Final survey history:",h),v(h)}catch(c){console.error("Error processing survey history:",c)}finally{m(!1)}})()},[s,u,o,n,d]);const j=r=>r?D(r,"d MMMM yyyy",{locale:L}):"-";return g?e.jsx("div",{className:"min-h-[70vh] flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 border-4 border-t-blue-500 border-b-blue-500 border-l-transparent border-r-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-secondary-900 mb-6",children:"Riwayat Survei"}),y.length===0?e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-secondary-600 mb-4",children:"Anda belum pernah mengisi survei."}),e.jsx("button",{onClick:()=>f("/directory"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Mulai Isi Survei"})]}):e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-primary-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-medium text-secondary-900",children:"Judul Survei"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-medium text-secondary-900",children:"Tanggal Pengisian"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-medium text-secondary-900",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-medium text-secondary-900",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-secondary-900",children:r.title}),e.jsx("td",{className:"px-6 py-4 text-sm text-secondary-600",children:j(r.completedAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Selesai"})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx(b,{to:`/history/${r.serviceId}`,className:"text-primary-600 hover:text-primary-900",children:"Lihat Detail"})})]},r.id))})]})})]})};export{C as default};
