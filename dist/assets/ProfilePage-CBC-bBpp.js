import{j as e,am as T,L as y,b as F,P as R,ah as E,e as U,ag as B,x as O,an as z,f as $}from"./ui-components-E1kookGP.js";import{j as H,r as h}from"./vendor-Bo00a0u0.js";import{u as _,m as n,A as V}from"./index-CxZZOcZu.js";import{u as J}from"./surveyStore-VDgMCFEy.js";import{u as Y}from"./directoryStore-HDTwRuRx.js";import{p as q}from"./parseISO-B6o4a0-U.js";import{i as G}from"./id-DKsBABLi.js";import{f as Q}from"./format-BWB-Nt1Y.js";import"./data-management-BXwEc-vo.js";import"./ui-framework-_byMagRW.js";import"./en-US-D9lzRxDE.js";const W=i=>{var l,d;const t=((l=i==null?void 0:i.gender)==null?void 0:l.toLowerCase())||((d=i==null?void 0:i.sex)==null?void 0:d.toLowerCase())||"";return t==="female"||t==="f"?"/profile_picture_female.png":"/profile_picture_male.png"},de=()=>{const i=H(),{user:t,isAuthenticated:l,logout:d}=_(),{allResponses:m,completedServices:u}=J(),{getServiceById:p}=Y(),[v,N]=h.useState(!0),[g,j]=h.useState([]),w=W(t),[k,f]=h.useState(!1);console.log("ProfilePage rendered",{isAuthenticated:l,user:t}),h.useEffect(()=>{if(console.log("ProfilePage useEffect",{isAuthenticated:l,user:t}),!l){console.log("User not authenticated, redirecting to login"),i("/login");return}const s=setTimeout(()=>{console.log("Loading complete"),S(),N(!1)},1e3);return()=>clearTimeout(s)},[l,i,t,m,u]);const S=()=>{console.log("Fetching recent surveys with data:",{allResponses:m,completedServices:u,userId:t==null?void 0:t.id});try{const s=t!=null&&t.id?m.filter(a=>a.userId===t.id):m;console.log("Filtered user responses:",s);const r=s.map(a=>{const o=p(a.serviceId),c=o?o.name:a.serviceName||`Survei Layanan ${a.serviceId}`;return{id:a.id,serviceId:a.serviceId,title:c,completedDate:a.completedAt?a.completedAt:new Date().toISOString(),status:"completed"}});u.forEach(a=>{if(!r.some(c=>c.serviceId===a)){const c=p(a),K=c?c.name:`Survei Layanan ${a}`;r.push({id:`service-${a}`,serviceId:a,title:K,completedDate:new Date().toISOString(),status:"completed"})}});const b=r.sort((a,o)=>new Date(o.completedDate)-new Date(a.completedDate)).slice(0,3);console.log("Final recent surveys:",b),j(b)}catch(s){console.error("Error fetching recent surveys:",s),j([])}},D=s=>{try{const r=typeof s=="string"?q(s):new Date(s);return Q(r,"d MMMM yyyy",{locale:G})}catch(r){return console.error("Date formatting error:",r),"Tanggal tidak valid"}},C={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},x={hidden:{y:10,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:300,damping:30}}},P={student:"Mahasiswa",lecturer:"Dosen",staff:"Tenaga Kependidikan",alumni:"Alumni",public:"Masyarakat Umum",stakeholder:"Mitra Kerjasama"},A={fuh:"Fakultas Ushuluddin dan Humaniora",ftk:"Fakultas Tarbiyah dan Keguruan",fsh:"Fakultas Syariah",febi:"Fakultas Ekonomi dan Bisnis Islam",fdik:"Fakultas Dakwah dan Ilmu Komunikasi",pasca:"Pascasarjana",rektorat:"Kantor Pusat",public:"Masyarakat Umum",stakeholder:"Mitra Kerjasama/Stakeholder"},L=()=>{console.log("Logging out"),d(),i("/login")},I=s=>{console.log(`Navigating to survey details for ${s}`),i(`/history/${s}`)},M=()=>{i("/history")};return!t&&l?(console.log("No user data but authenticated"),e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full text-center",children:[e.jsx(T,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Data Profil Tidak Tersedia"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Terjadi kesalahan saat memuat data profil Anda."}),e.jsx("button",{onClick:()=>i("/"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Kembali ke Beranda"})]})})):v?(console.log("Showing loading state"),e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Memuat profil Anda..."})]})):e.jsxs("div",{className:"min-h-screen pt-20 pb-12 px-6 md:px-8",children:[e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs(n.div,{variants:C,initial:"hidden",animate:"visible",className:"space-y-8",children:[e.jsxs(n.div,{variants:x,className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800 tracking-wide",children:"Profil Pengguna"}),e.jsx("p",{className:"text-lg font-normal text-gray-500 mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 space-y-6",children:[e.jsx(n.div,{variants:x,className:"bg-white rounded-3xl shadow-md overflow-hidden",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6 p-7 relative",children:[e.jsx("div",{className:"absolute top-5 right-6 hidden md:block",children:e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center justify-center px-3 py-1.5 border border-red-200 rounded-full text-red-500 bg-white hover:bg-red-50 transition-colors",children:[e.jsx(y,{size:15,className:"mr-1.5"}),e.jsx("span",{className:"text-sm font-medium",children:"Keluar"})]})}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-white ring-4 ring-blue-100 overflow-hidden",children:t!=null&&t.profileImage?e.jsx("img",{src:t.profileImage,alt:(t==null?void 0:t.name)||"User Profile",className:"w-full h-full object-cover"}):e.jsx("img",{src:w,alt:(t==null?void 0:t.name)||"User Profile",className:"w-full h-full object-cover"})})}),e.jsxs("div",{className:"flex flex-col text-center md:text-left",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:(t==null?void 0:t.name)||"Nama Pengguna"}),e.jsx("div",{className:"inline-flex items-center px-3 py-1 mt-2 rounded-full bg-blue-100 text-blue-700 text-sm font-medium self-center md:self-start",children:P[t==null?void 0:t.role]||"Jenis Responden"}),e.jsxs("div",{className:"mt-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx("div",{className:"w-7 flex items-center justify-center",children:e.jsx(F,{className:"w-4 h-4 text-blue-500"})}),e.jsx("span",{className:"text-base",children:(t==null?void 0:t.email)||"email@example.com"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx("div",{className:"w-7 flex items-center justify-center",children:e.jsx(R,{className:"w-4 h-4 text-green-500"})}),e.jsx("span",{className:"text-base",children:(t==null?void 0:t.whatsapp)||(t==null?void 0:t.phone)||"+628123456789"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx("div",{className:"w-7 flex items-center justify-center",children:e.jsx(E,{className:"w-4 h-4 text-teal-500"})}),e.jsx("span",{className:"text-base truncate max-w-xs",children:A[t==null?void 0:t.respondentOrigin]||(t==null?void 0:t.faculty)||"Asal Responden"})]})]})]})]})}),e.jsx(n.div,{variants:x,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-7",style:{background:"linear-gradient(to right, #3b82f608, white 15%)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 tracking-wide",children:"Survei yang Telah Diisi"}),e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 bg-blue-100",children:e.jsx(U,{className:"h-5 w-5 text-blue-500"})})]}),e.jsxs("div",{className:"space-y-3",children:[g.length>0?g.map(s=>e.jsx("div",{onClick:()=>I(s.serviceId),className:"p-3 rounded-xl border border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Diisi pada ",D(s.completedDate)]})]}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-md text-xs font-medium",children:[e.jsx(B,{size:12}),e.jsx("span",{children:"Selesai"})]})]})},s.id)):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-50 flex items-center justify-center",children:e.jsx(O,{className:"h-8 w-8 text-blue-300"})})}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Anda belum pernah mengisi survei."}),e.jsxs("button",{onClick:()=>i("/directory"),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium inline-flex items-center",children:[e.jsx(z,{size:16,className:"mr-2"}),"Mulai Isi Survei"]})]}),g.length>0&&e.jsx("div",{className:"pt-4 mt-2 border-t border-gray-100",children:e.jsxs("button",{onClick:M,className:"flex items-center text-blue-600 hover:text-blue-700 font-semibold text-sm transition-colors",children:[e.jsx("span",{children:"Lihat Riwayat Lengkap"}),e.jsx($,{className:"h-4 w-4 ml-1"})]})})]})]})})]}),e.jsx("div",{className:"col-span-12 lg:hidden mt-6",children:e.jsx(n.div,{variants:x,children:e.jsxs("button",{onClick:()=>f(!0),className:"w-full py-3 px-4 flex items-center justify-center bg-white border border-red-200 text-red-500 font-medium rounded-2xl hover:bg-red-50 transition-colors",children:[e.jsx("span",{className:"w-5 h-5 flex items-center justify-center mr-2",children:e.jsx(y,{size:16})}),e.jsx("span",{children:"Keluar dari Akun"})]})})})]})]})}),e.jsx(V,{children:k&&e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs(n.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-3 tracking-wide",children:"Konfirmasi Keluar"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Apakah Anda yakin ingin keluar dari akun?"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors",children:"Batal"}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors",children:"Ya, Keluar"})]})]})})})]})};export{de as default};
